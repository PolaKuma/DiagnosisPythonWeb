{"remainingRequest":"/Users/junjie/Documents/GitHub/Untitled/vue-admin-template/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/junjie/Documents/GitHub/Untitled/vue-admin-template/src/views/patientManage/shift.vue?vue&type=style&index=0&lang=css&","dependencies":[{"path":"/Users/junjie/Documents/GitHub/Untitled/vue-admin-template/src/views/patientManage/shift.vue","mtime":1702207301128},{"path":"/Users/junjie/Documents/GitHub/Untitled/vue-admin-template/node_modules/css-loader/dist/cjs.js","mtime":1702214741993},{"path":"/Users/junjie/Documents/GitHub/Untitled/vue-admin-template/node_modules/vue-loader/lib/loaders/stylePostLoader.js","mtime":1702214744817},{"path":"/Users/junjie/Documents/GitHub/Untitled/vue-admin-template/node_modules/postcss-loader/src/index.js","mtime":1702214743077},{"path":"/Users/junjie/Documents/GitHub/Untitled/vue-admin-template/node_modules/cache-loader/dist/cjs.js","mtime":1702214739870},{"path":"/Users/junjie/Documents/GitHub/Untitled/vue-admin-template/node_modules/vue-loader/lib/index.js","mtime":1702214743778}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKLnNoaWZ0IHsKICBoZWlnaHQ6IDcwMHB4OwogIHdpZHRoOiAxMTYwcHg7CiAgYmFja2dyb3VuZC1jb2xvcjogd2hpdGU7CiAgYm94LXNoYWRvdzogMCAxNXB4IDMwcHggcmdiYSgwLCAwLCAwLCAuMyk7Cn0KCi5zZWFyY2ggewogIHBhZGRpbmc6IDMwcHg7CiAgcGFkZGluZy1ib3R0b206IDEwcHg7Cn0KCi5lbC1idXR0b24gewogIG1hcmdpbi1sZWZ0OiAxMHB4OwogIG1hcmdpbi1ib3R0b206IDMwcHg7CiAgYm9yZGVyLXJhZGl1czogMTAlOwogIG1hcmdpbi1sZWZ0OiAzMHB4Owp9Cg=="},{"version":3,"sources":["shift.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAiUA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA","file":"shift.vue","sourceRoot":"src/views/patientManage","sourcesContent":["<template>\n  <div class=\"shift\">\n    <div class=\"title\">\n    </div>\n    <div class=\"search\">\n      <el-input style=\"width: 200px;\" class=\"filter-item\" placeholder=\"请输入姓名\" v-model=\"searchName\"></el-input>\n      <el-button class=\"filter-item\" type=\"primary\" icon=\"el-icon-search\" @click=\"handelSearch\">搜索</el-button>\n      <el-button type=\"primary\" icon=\"\" @click=\"getAll\">显示全部</el-button>\n      <el-button v-if=\"usertype===1\" class=\"filter-item\" type=\"primary\" @click=\"handelCreate\" icon=\"el-icon-edit\">添加</el-button>\n      <el-button v-if=\"usertype===1\" class=\"filter-item\" type=\"primary\" @click=\"handleDelAll\" icon=\"el-icon-delete\">清空</el-button>\n      <el-button class=\"filter-item\" type=\"primary\" icon=\"el-icon-share\" @click=\"handleDownload\">导出</el-button>\n    </div>\n\n    <el-table id=\"pdf\" :header-cell-style=\"{background:'#f5f7fa',color:'#606266'}\" :data=\"table\" border style=\"width: 100%\"\n              height=\"400\">\n      <el-table-column fixed=\"left\" type=\"index\" label=\"序号\" align=\"center\" width=\"70\"/>\n      <el-table-column prop=\"date\" fixed label=\"日期\" width=\"120\"/>\n      <el-table-column prop=\"arrange\" label=\"时段\" width=\"200\"/>\n      <el-table-column prop=\"doctor_id\" label=\"医生ID\" width=\"150\"/>\n      <el-table-column prop=\"realname\" label=\"姓名\" width=\"150\"/>\n      <el-table-column prop=\"gender\" label=\"性别\" width=\"150\"/>\n      <el-table-column prop=\"telephone\" label=\"电话号码\" width=\"150\"/>\n      <el-table-column prop=\"attendance\" label=\"出勤情况\" width=\"120\"/>\n      <el-table-column prop=\"response\" label=\"负责人\" width=\"120\"/>\n      <el-table-column align=\"center\" label=\"操作\" fixed=\"right\" width=\"200px\">\n        <template v-slot=\"{row}\">\n          <el-button size=\"small\" @click=\"handleEdit(row)\">编辑</el-button>\n          <el-button size=\"small\" type=\"danger\" @click=\"handleDelete(row)\">删除</el-button>\n        </template>\n      </el-table-column>\n    </el-table>\n    <el-pagination\n      background\n      style=\"margin-top: 20px;text-align: center\"\n      :current-page=\"pageNum\"\n      :page-size=\"pageSize\"\n      :total=\"total\"\n      :pager-count=\"10\"\n      :page-sizes=\"[10,15,30]\"\n      layout=\"prev,pager,next,jumper,->,sizes,total\"\n      @current-change=\"getShiftList\"\n      @size-change=\"handleSizeChange\"\n    />\n    <!-- 对话框 -->\n    <el-dialog\n      :title=\"form.id ? '修改值班信息':'新增值班信息'\"\n      :visible.sync=\"dialogFormVisible\"\n      width=\"50%\"\n      @close=\"resetForm\"\n    >\n      <el-form :model=\"form\" ref=\"formData\" label-width=\"80px\" style=\"margin-bottom: 20px;\">\n        <el-form-item label=\"日期\">\n          <el-date-picker v-model=\"form.date\" type=\"date\" placeholder=\"选择日期\"></el-date-picker>\n        </el-form-item>\n        <el-form-item label=\"时段\">\n          <el-select v-model=\"form.arrange\" placeholder=\"选择时段\">\n            <el-option label=\"早班8:00-12:00\" value=\"早班8:00-12:00\"></el-option>\n            <el-option label=\"午班12:00-18:00\" value=\"午班12:00-18:00\"></el-option>\n            <el-option label=\"晚班18:00-24:00\" value=\"晚班18:00-24:00\"></el-option>\n            <el-option label=\"夜班0:00-8:00\" value=\"夜班0:00-8:00\"></el-option>\n          </el-select>\n        </el-form-item>\n        <el-form-item label=\"医生ID\">\n          <el-input v-model=\"form.doctor_id\" placeholder=\"请输入医生ID\"></el-input>\n        </el-form-item>\n        <el-form-item label=\"姓名\">\n          <el-input v-model=\"form.realname\" placeholder=\"请输入姓名\"></el-input>\n        </el-form-item>\n        <el-form-item label=\"性别\">\n          <el-radio-group v-model=\"form.gender\">\n            <el-radio label=\"male\">男</el-radio>\n            <el-radio label=\"female\">女</el-radio>\n          </el-radio-group>\n        </el-form-item>\n        <el-form-item label=\"电话号码\">\n          <el-input v-model=\"form.telephone\" placeholder=\"请输入电话号码\"></el-input>\n        </el-form-item>\n        <el-form-item label=\"出勤情况\">\n          <el-select v-model=\"form.attendance\" placeholder=\"选择出勤情况\">\n            <el-option label=\"迟到\" value=\"迟到\"></el-option>\n            <el-option label=\"按时值班\" value=\"按时值班\"></el-option>\n            <el-option label=\"请假\" value=\"请假\"></el-option>\n            <el-option label=\"旷工\" value=\"旷工\"></el-option>\n          </el-select>\n        </el-form-item>\n        <el-form-item label=\"负责人\">\n          <el-input v-model=\"form.response\" placeholder=\"请输入负责人\"></el-input>\n        </el-form-item>\n      </el-form>\n      <div slot=\"footer\" class=\"dialog-footer\">\n        <el-button @click=\"dialogFormVisible = false\">取 消</el-button>\n        <el-button type=\"primary\" @click=\"handleCreateSubmit(form.id)\">确 定</el-button>\n        <el-button type=\"primary\" @click=\"formClear\">重置</el-button>\n      </div>\n    </el-dialog>\n  </div>\n</template>\n\n<script>\n\nimport html2Canvas from 'html2canvas'\nimport jsPDF from 'jspdf'\nimport { mapGetters } from 'vuex'\n\nexport default {\n  computed: {\n    ...mapGetters([\n      'usertype'\n    ])\n  },\n  data() {\n    return {\n      table: [],\n      pageNum: 1,\n      pageSize: 10,\n      total: 0,\n      loading: false,\n      searchName: '',\n      dialogFormVisible: false,\n      editingRowIndex: -1,\n      form: {\n        date: '',\n        arrange: '',\n        doctor_id: '',\n        realname: '',\n        gender: '',\n        telephone: '',\n        attendance: '',\n        response: ''\n      }\n    }\n  },\n  mounted() {\n    this.getShiftList(1)\n  },\n  methods: {\n    async getShiftList(pager = 1) {\n      this.loading = true\n      this.pageNum = pager\n      const { pageNum, pageSize } = this\n      var search = this.searchName\n      if (search === '') {\n        search = 'None'\n      }\n      const res = await this.$API.flow.findDuty(pageNum, pageSize, search)\n      if (res.code === 200) {\n        this.table = res.msg\n        this.total = res.total\n        this.loading = false\n      }\n    },\n    handleSizeChange(limit) {\n      this.pageSize = limit\n      this.getShiftList()\n    },\n    handleEdit(row) {\n      this.form = {...row}\n      this.dialogFormVisible = true\n    },\n    // 搜索\n    handelSearch() {\n      this.getShiftList(1)\n    },\n    handleDownload() {\n      var title = '值班表'\n      html2Canvas(document.querySelector('#pdf'), {\n        allowTaint: true,\n        taintTest: false,\n        useCORS: true,\n        y: 72, // 对Y轴进行裁切\n        // width:1200,\n        // height:5000,\n        dpi: window.devicePixelRatio * 4,\n        scale: 4\n      }).then(function (canvas) {\n        let contentWidth = canvas.width\n        let contentHeight = canvas.height\n        let pageHeight = contentWidth / 592.28 * 841.89\n        let leftHeight = contentHeight\n        let position = 0\n        let imgWidth = 595.28\n        let imgHeight = 592.28 / contentWidth * contentHeight\n        let pageData = canvas.toDataURL('image/jpeg', 1.0)\n        let PDF = new jsPDF('', 'pt', 'a4')\n        if (leftHeight < pageHeight) {\n          PDF.addImage(pageData, 'JPEG', 0, 0, imgWidth, imgHeight)\n        } else {\n          while (leftHeight > 0) {\n            PDF.addImage(pageData, 'JPEG', 0, position, imgWidth, imgHeight)\n            leftHeight -= pageHeight\n            position -= 841.89\n            if (leftHeight > 0) {\n              PDF.addPage()\n            }\n          }\n        }\n        PDF.save(title + '.pdf')\n      })\n    },\n    // 显示全部\n    getAll() {\n      this.searchName = ''\n      this.getShiftList(1)\n    },\n    // 删除\n    handleDelete(row) {\n      this.$confirm(`你确定删除 ${row.realname} 吗?`, '删除', {\n        confirmButtonText: '确定',\n        cancelButtonText: '取消',\n        type: 'warning'\n      }).then(async () => {\n        const result = await this.$API.flow.delDuty(row.id)\n        if (result.code === 200) {\n          this.$notify({\n              type: 'success',\n              message: '删除成功!'\n            }, await this.getShiftList(this.table.length > 1 ? this.pageNum : this.pageNum - 1)\n          )\n        } else {\n          this.$notify({\n            type: 'warning',\n            message: '删除失败,请联系系统运维!'\n          })\n        }\n      }).catch(() => {\n        this.$notify({\n          type: 'info',\n          message: '已取消删除'\n        })\n      })\n    },\n    // 清空\n    handleDelAll() {\n      this.$confirm(`你确定清空值班记录吗?`, '删除', {\n        confirmButtonText: '确定',\n        cancelButtonText: '取消',\n        type: 'warning'\n      }).then(async () => {\n        const result = await this.$API.flow.delAllDuty()\n        if (result.code === 200) {\n          this.$notify({\n              type: 'success',\n              message: '清空成功!'\n            }, await this.getShiftList(this.table.length > 1 ? this.pageNum : this.pageNum - 1)\n          )\n        } else {\n          this.$notify({\n            type: 'warning',\n            message: '删除失败,请联系系统运维!'\n          })\n        }\n      }).catch(() => {\n        this.$notify({\n          type: 'info',\n          message: '已取消删除'\n        })\n      })\n    },\n    // 添加\n    handelCreate() {\n      this.dialogFormVisible = true\n      this.formClear()\n    },\n    // 添加提交\n    async handleCreateSubmit(id) {\n      if (id) {\n        const res = await this.$API.flow.update_Duty(this.form)\n        if (res.code === 200) {\n          // 关闭表单\n          this.dialogFormVisible = false\n          // 消息提示\n          this.$message({\n            message: '修改成功!',\n            type: 'success'\n          }, await this.getShiftList(this.form.id ? this.pageNum : 1))\n        }\n      } else {\n        const res = await this.$API.flow.add_Duty(this.form)\n        if (res.code === 200) {\n          // 关闭表单\n          this.dialogFormVisible = false\n          // 消息提示\n          this.$message({\n            message: '添加成功!',\n            type: 'success'\n          }, await this.getShiftList(this.form.id ? this.pageNum : 1))\n        }\n      }\n    },\n    // 清空表单\n    formClear() {\n      this.form = {\n        date: '',\n        arrange: '',\n        doctor_id: '',\n        realname: '',\n        gender: '',\n        telephone: '',\n        attendance: '',\n        response: ''\n      }\n    },\n    // 重置表单\n    resetForm() {\n      this.form = {\n        date: '',\n        arrange: '',\n        doctor_id: '',\n        realname: '',\n        gender: '',\n        telephone: '',\n        attendance: '',\n        response: ''\n      }\n      this.editingRowIndex = -1\n    }\n  }\n}\n</script>\n\n<style>\n.shift {\n  height: 700px;\n  width: 1160px;\n  background-color: white;\n  box-shadow: 0 15px 30px rgba(0, 0, 0, .3);\n}\n\n.search {\n  padding: 30px;\n  padding-bottom: 10px;\n}\n\n.el-button {\n  margin-left: 10px;\n  margin-bottom: 30px;\n  border-radius: 10%;\n  margin-left: 30px;\n}\n</style>\n"]}]}